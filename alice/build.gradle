apply plugin: 'java'
apply plugin: 'groovy'
apply plugin: 'jacoco'

version = '0.5'

sourceCompatibility = JavaVersion.VERSION_1_8
targetCompatibility = JavaVersion.VERSION_1_8

dependencies {
    compile "org.codehaus.groovy:groovy-all:2.5.23"

    testCompile 'org.spockframework:spock-core:1.3-groovy-2.5'
    testCompile group: 'commons-io', name: 'commons-io', version: '2.17.0'
    testCompile group: 'org.apache.commons', name: 'commons-lang3', version: '3.17.0'
    testCompile group: 'org.junit.jupiter', name: 'junit-jupiter-engine', version: '5.11.3'
    testRuntime group: 'org.junit.vintage', name: 'junit-vintage-engine', version: '4.12.3'
}

task copyDocs(dependsOn: 'javadoc', type: Copy) {
    println("Copying javadoc...")
    from tasks.javadoc.destinationDir
    into "$rootProject.rootDir/docs"
}

task codeCoverageReport(type: JacocoReport) {
    executionData fileTree(project.rootDir.absolutePath).include("**/build/jacoco/*.exec")

    sourceDirectories = files(sourceSets.main.allJava.srcDirs)
    classDirectories = fileTree(tasks.compileJava.destinationDir)

    reports {
        xml.enabled true
        xml.destination file("${buildDir}/reports/jacoco/report.xml")
        html.enabled true
        csv.enabled false
    }
}

codeCoverageReport.dependsOn test